<!Doctype html>
<html lang="en">
    <head>
        <link type="text/css" rel="stylesheet" href="css/materialize.css"  media="screen,projection"/>
        <link type="text/css" rel="stylesheet" href="css/fontawesome-all.css"  media="screen,projection"/>
        <title>Create User Account</title>
    </head>
    <body class="grey lighten-4">
        <div class="container">
            <form>
                <div class="row">
                    <label>First Name</label>
                    <input type="text" id="firstNameInput" autofocus required>
                </div>
                <div class="row">
                    <label>Middle Initial</label>
                    <input type="text" id="middleInitialInput">
                </div>
                <div class="row">
                    <label>Last Name</label>
                    <input type="text" id="lastNameInput" required>
                </div>
                <div class="row">
                    <label>Email</label>
                    <input type="email" id="emailInput">
                </div>
                <div class="row">
                    <label>Password</label>
                    <input type="password" id="passwordInput" required>
                </div>
                <div class="row">
                    <label>Repeat Password</label>
                    <input type="password" id="repeatPasswordInput" required>
                </div>
                <div class="row">
                    <div class="center-align">
                        <button type="submit" class="blue-grey darken-2 btn">
                            Create Account
                        </button>
                    </div>
                </div>
            </form>
        </div>
        

        <script>
            const electron = require('electron');
            const {ipcRenderer} = electron;

            const form = document.querySelector('form');
            form.addEventListener('submit', submitForm);

            function submitForm(e) {
                e.preventDefault();
                if (isFormValid()) {
                    sendToMain();
                }
            }

            function isPasswordValid(e) {

            }

            function isFormValid() {
                var isValid = true;
                if (!doPasswordsMatch()) {
                    isValid = false;
                    document.querySelector('#passwordInput').value = '';
                    document.querySelector('#repeatPasswordInput').value = '';
                    alert("Passwords must match");
                }
                if (!isEmailValid(document.querySelector('#emailInput').value)) {
                    isValid = false;
                    alert("Valid email address is required");
                }

                return isValid;
            }
            
            function doPasswordsMatch() {
                const password = document.querySelector('#passwordInput').value;
                const password2 = document.querySelector('#repeatPasswordInput').value;
                return password == password2;
            }

            function isEmailValid(email) {
                var regex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return regex.test(email);
            }

            function sendToMain() {
                const firstName = document.querySelector('#firstNameInput').value;
                const middleInitial = document.querySelector('#middleInitialInput').value;
                const lastName = document.querySelector('#lastNameInput').value;
                const email = document.querySelector('#emailInput').value;
                const password = document.querySelector('#passwordInput').value;
                ipcRenderer.send('userAccount:add', firstName, middleInitial, lastName, email, password);
            }
        </script>
        <script type="text/javascript" src="js/materialize.js"></script>
    </body>
</html>
