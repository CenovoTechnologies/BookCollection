<!Doctype html>
<html lang="en">
	<head>
		<title>Add New Book</title>
	</head>
	<body>
		<div id="usefulInfo">
			<div hidden id="userId"></div>
			<div hidden id="collectionId"></div>
		</div>
		<form>
			<div>
				<label>Title</label>
				<input type="text" id="titleInput" autofocus>
			</div>
			<div>
				<label>Sub-Title</label>
				<input type="text" id="subTitleInput">
			</div>
			<div>
				<label>Author</label>
				<input type="text" id="authorInput">
			</div>
			<div>
				<label>ISBN</label>
				<input type="text" id="IsbnInput">
			</div>
			<div>
				<label>Genre</label>
				<select id="bookGenres"></select>
			</div>
			<div>
				<label>Format</label>
				<select id="bookFormats"></select>
			</div>
			<div>
				<label>Number of Pages</label>
				<input type="number" id="pagesInput">
			</div>
			<div>
				<label>LocClassification</label>
				<input type="text" id="locClassificationInput">
			</div>
			<div>
				<label>Dewey</label>
				<input type="text" id="deweyInput">
			</div>
			<div>
				<label>Publisher</label>
				<input type="text" id="publisherInput">
			</div>
			<div>
				<label>Publisher Date</label>
				<input type="date" id="publisherDateInput">
			</div>
			<div>
				<label>Plot</label>
				<textarea name="plot" id="plotInput" rows="5" cols="15"></textarea>
			</div>
			<button type="submit" id="addBookBtn">Add New Book</button>
		</form>

		<script>
			const electron = require('electron');
			const {ipcRenderer} = electron;
			const addBookBtn = document.querySelector('#addBookBtn');

			addBookBtn.addEventListener('click', addBook);
			
			ipcRenderer.on('addBook:init', function(e, userId, collectionId) {
				setUserId(userId);
				setCollectionId(collectionId);
				getBookGenres();
				getBookFormats();
			});
			
			ipcRenderer.on('bookFormat:getAll', function(e, formats) {
				var options = '';
				for (f in formats) {
					options += '<option value='+formats[f].BookFormatId+'>'+formats[f].Format+'</option>';
				}
				document.getElementById('bookFormats').innerHTML = options;
			});

			ipcRenderer.on('bookGenre:getAll', function(e, genres) {
				var options = '';
				for (g in genres) {
					options += '<option value='+genres[g].BookGenreId+'>'+genres[g].Genre+'</option>';
				}
				document.getElementById('bookGenres').innerHTML = options;
			});

			function setUserId(userId) {
				document.querySelector('#userId').innerHTML = userId;
			}

			function setCollectionId(collectionId) {
				document.querySelector('#collectionId').innerHTML = collectionId;
			}

			function getBookGenres() {
				ipcRenderer.send('bookGenre:getAll');
			}

			function getBookFormats() {
				ipcRenderer.send('bookFormat:getAll');
			}

			function addBook(e) {
				e.preventDefault();
				const userId = document.querySelector('#userId').innerHTML;
				const collectionId = document.querySelector('#collectionId').innerHTML;

				ipcRenderer.send('book:add', userId, collectionId);
			}
		</script>
	</body>
</html>
