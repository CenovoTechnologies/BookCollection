<!Doctype html>
<html lang="en">
	<head>
		<title>Add New Book</title>
	</head>
	<body>
		<div id="usefulInfo">
			<div hidden id="userId"></div>
			<div hidden id="collectionId"></div>
		</div>
		<form>
			<div>
				<label>Title</label>
				<input type="text" id="titleInput" autofocus>
			</div>
			<div>
				<label>Sub-Title</label>
				<input type="text" id="subTitleInput">
			</div>
			<div>
				<label>Author</label>
				<input type="text" id="authorInput">
			</div>
			<div>
				<label>ISBN</label>
				<input type="text" id="IsbnInput">
			</div>
			<div>
				<label>Genre</label>
				<select id="bookGenres"></select>
			</div>
			<div>
				<label>Format</label>
				<select id="bookFormats"></select>
			</div>
			<div>
				<label>Number of Pages</label>
				<input type="number" id="pagesInput">
			</div>
			<div>
				<label>LocClassification</label>
				<input type="text" id="locClassificationInput">
			</div>
			<div>
				<label>Dewey</label>
				<input type="text" id="deweyInput">
			</div>
			<div>
				<label>Publisher</label>
				<input type="text" id="publisherInput">
			</div>
			<div>
				<label>Publisher Date</label>
				<input type="date" id="publisherDateInput">
			</div>
			<div>
				<label>Plot</label>
				<textarea name="plot" id="plotInput" rows="5" cols="15"></textarea>
			</div>
			<button type="submit" id="addBookBtn">Add New Book</button>
		</form>

		<script>
			const electron = require('electron');
			const {ipcRenderer} = electron;
			const addBookBtn = document.querySelector('#addBookBtn');

			addBookBtn.addEventListener('click', addBook);
			
			ipcRenderer.on('addBook:init', function(e, userId, collectionId) {
				setUserId(userId);
				setCollectionId(collectionId);
				getBookGenres();
				getBookFormats();
			});
			
			ipcRenderer.on('bookFormat:getAll', function(e, formats) {
				var options = '';
				for (f in formats) {
					options += '<option value='+formats[f].bookFormatId+'>'+formats[f].format+'</option>';
				}
				document.getElementById('bookFormats').innerHTML = options;
			});

			ipcRenderer.on('bookGenre:getAll', function(e, genres) {
				var options = '';
				for (g in genres) {
					options += '<option value='+genres[g].bookGenreId+'>'+genres[g].genre+'</option>';
				}
				document.getElementById('bookGenres').innerHTML = options;
			});

			function setUserId(userId) {
				document.querySelector('#userId').innerHTML = userId;
			}

			function setCollectionId(collectionId) {
				document.querySelector('#collectionId').innerHTML = collectionId;
			}

			function getBookGenres() {
				ipcRenderer.send('bookGenre:getAll');
			}

			function getBookFormats() {
				ipcRenderer.send('bookFormat:getAll');
			}

			function addBook(e) {
				e.preventDefault();
				var bookGenre = document.getElementById('bookGenres');
				var bookFormat = document.getElementById('bookFormats');
				const collectionId = document.querySelector('#collectionId').innerHTML;
				var request = JSON.stringify({
					"CollectionId": collectionId,
					"Title": document.getElementById('titleInput').value,
					"SubTitle": document.getElementById('subTitleInput').value,
					"Authors": [],
					"ISBN": document.getElementById('IsbnInput').value,
					"BookGenreId": bookGenre.options[bookGenre.selectedIndex].value,
					"BookFormatId": bookFormat.options[bookFormat.selectedIndex].value,
					"NumberOfPages": document.getElementById('pagesInput').value,
					"Loc Classification": document.getElementById('locClassificationInput').value,
					"Dewey": document.getElementById('deweyInput').value,
					"Publisher": document.getElementById('publisherInput').value,
					"PublisherDate": document.getElementById('publisherDateInput').value,
					"Plot": document.getElementById('plotInput').value
				});
				ipcRenderer.send('book:add', request);
			}
		</script>
	</body>
</html>
