<!Doctype html>
<html lang="en">
<head>
	<title>Collection</title>
</head>
<body>
    <div id="usefulInfo">
        <div hidden id="userId"></div>
        <div hidden id="collectionId"></div>
    </div>
    <h3 id="collectionName"></h3>
    <div>
        <button type="button" id="backBtn">Return to Homepage</button>
    </div>
    <div>
        <button type="button" id="addBookBtn">Add New Book</button>
    </div>
    <div id="bookList">
    </div>

	<script>
        const electron = require('electron');
        const {ipcRenderer} = electron;
        const collection = document.querySelector('#collectionName');
        const addBookBtn = document.querySelector('#addBookBtn');
        const backBtn = document.querySelector('#backBtn');
        const bookList = document.querySelector('#bookList');

        addBookBtn.addEventListener('click', createBook);
        backBtn.addEventListener('click', returnToHomepage);

        ipcRenderer.on('collection:open', function(e, collectionName, collectionId, userId) {
            document.querySelector('#collectionName').innerHTML = collectionName;
            document.querySelector('#collectionId').innerHTML = collectionId;
            document.querySelector('#userId').innerHTML = userId;
            getBooksForCollection(collectionId);
        });

        ipcRenderer.on('book:add', function(e, book) {
            addBookToList(book);
        });

        ipcRenderer.on('collection:getBooks', function(e, books) {
            for(b in books) {
                addBookToList(books[b]);
            }
        });

        function createBook(e) {
            e.preventDefault();
            ipcRenderer.send('addBookBtn:click', document.querySelector('#userId').innerHTML, document.querySelector('#collectionId').innerHTML);
        }

        function returnToHomepage(e) {
            e.preventDefault();
            ipcRenderer.send('homepage:return');
        }

        function getBooksForCollection(collectionId) {
            ipcRenderer.send('collection:getBooks');
        }

        function addBookToList(book) {
            var text = book.title;
            if (book.author != null) {
                text = text + ' By: ' + book.author;
            }
            const bookItem = document.createTextNode(text);
            bookList.appendChild(bookItem);
        }
        
	</script>
</body>
</html>
